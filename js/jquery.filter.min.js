!function(p){var m={itemShowCounts:2,items:[],vagueKey:"keywords",callback:function(t){},separator:"~"},i={init:function(t){return m=p.extend({},m,t),this.each(function(){var t=p(this);t.empty(),t.data("filterOpt",m),e(t)})},getValues:function(){var t=[];return this.each(function(){t.push(v(p(this).find(".filter-box")))}),t},destroy:function(t){return this.each(function(){p(this).empty()})}};p.fn.extend({filter:function(t){var e=t;if(i[e])e=i[e],arguments=Array.prototype.slice.call(arguments,1);else{if("object"!=typeof e&&e)return p.error("Method "+e+" does not exist on jQuery.pluginName"),this;e=i.init}return e.apply(this,arguments)}});var e=function(t){var e=p('<div class="filter-box"><div class="filter-view"><div class="filter-col filter-ctrl"><button type="button"class="senior-btn button button-border button-caution">高级搜索</button></div><div class="filter-col filter-list"></div><div class="filter-col filter-search"><input type="text"class="vague-input"value=""placeholder="模糊查询"/><button type="button"class="vague-btn button button-square button-border button-caution">搜索</button></div></div><div class="filter-config"><div class="more-items on"><span class="more-info">更多</span></div></div></div>');e.appendTo(t),n(e),a(e),f(e)},n=function(t){t.find(".more-items").bind("click",function(){f(t)}),t.find(".senior-btn").bind("click",function(){t.find(".filter-config").toggle()}),t.find(".filter-config").on("click",".item-normal",function(){p(this).addClass("on").siblings(".item-opt").removeClass("on"),r(p(this),t)}),t.find(".filter-config").on("click",".filter-other-btn",function(){p(this).parent().siblings(".item-opt").removeClass("on"),r(p(this).parent(),t)}),t.find(".vague-btn").bind("click",function(){"function"==typeof m.callback&&m.callback.call(this,v(t))})},a=function(r){var t=m.items;0<t.length?p.each(t,function(t,e){var i=p('<div class="filter-item"  filter-name="" filter-title=""><div>'),n=p('<div class="item-label">'+e.text+"</div>"),a=p('<div class="item-options"></div>');i.attr("filter-name",e.name),i.attr("filter-title",e.text),i.append(n),i.append(a),i.insertBefore(r.find(".more-items")),l(a),o(a,e.opts),s(a,e)}):p("<span class='no-more'>没有更多筛选</span>").insertBefore(r.find(".more-items"))},l=function(t){t.append('<div class="item-opt item-normal on" filter-val="">不限</div>')},o=function(n,t){p.each(t,function(t,e){var i=p('<div class="item-opt item-normal" >'+e.text+"</div>");i.attr("filter-val",e.value),i.appendTo(n)})},s=function(t,e){if("range"==e.type){var i=p('<div class="item-opt item-range"><input type="number" class="input-txt" name="" id="" value="" /><em>-</em><input type="text" class="input-txt" name="" id="" value="" /><a class="button button-tiny filter-other-btn">确认</a></div>');t.append(i),i.data(e)}else if("daterange"==e.type){i=p('<div class="item-opt item-daterange"><input type="text" class="input-date" placeholder="选择范围"  /><a class="button button-tiny filter-other-btn">确认</a></div>');t.append(i);var n=e.separator||m.separator;laydate.render({format:e.format,elem:i.find(".input-date")[0],theme:"#ff0000",range:n,done:function(t,e,i){}}),i.data(e)}},r=function(t,e){var i=t.parents(".filter-item"),n=e.find(".filter-list").find(".filter-tag[filter-name="+i.attr("filter-name")+"]"),a="",r="";if(t.hasClass("item-range")){for(var l=p.map(t.find("input"),function(t,e){return t.value}),o=t.data(),s=o.separator||m.separator,f=[],c=[],d=0;d<l.length;d++)f.push(l[d]*o.multiple),c.push(l[d]+o.unit);a=f.join(s),r=i.attr("filter-title")+":"+c.join(s)}else r=t.hasClass("item-daterange")?(a=t.find("input").val(),i.attr("filter-title")+":"+a):(a=t.attr("filter-val"),i.attr("filter-title")+":"+t.text());if(""==a)n.remove();else{if(0==n.length){(n=p('<div class="filter-tag"><span class="tag-content"></span></div>')).appendTo(e.find(".filter-list"));var u=p("<span class='tag-close'>x</span>");u.appendTo(n),u.bind("click",function(){p(this).parents(".filter-tag").remove(),"function"==typeof m.callback&&m.callback.call(this,v(e))})}n.data("value",a).attr("filter-name",i.attr("filter-name")).find(".tag-content").text(r)}"function"==typeof m.callback&&m.callback.call(this,v(e))},f=function(t){t.find(".more-items").hasClass("on")?(t.find(".more-items").removeClass("on").find(".more-info").text("更多"),p.each(t.find(".filter-item"),function(t,e){t<m.itemShowCounts?p(e).show():p(e).hide()})):(t.find(".more-items").addClass("on").find(".more-info").text("收缩"),p(".filter-item").show())},v=function(t){var e=p.map(t.find(".filter-list").find(".filter-tag"),function(t,e){var i={};return i[p(t).attr("filter-name")]=p(t).data("value"),i}),i={};return i[m.vagueKey]=t.find(".vague-input").val(),e.push(i),e}}(jQuery);